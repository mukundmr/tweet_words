
<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="import" href="bower_components/polymer/polymer.html">
    <link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
    <link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
    <link rel="import" href="bower_components/core-icons/core-icons.html">
    <link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="bower_components/core-item/core-item.html">

    <link rel="import" href="elements/tw-menu.html">
    <link rel="import" href="elements/tw-paper-input.html">
    

  </head>
  <style>
        body {
          font-family: sans-serif;
        }
        core-header-panel {
          background: white;
        }
        core-toolbar {
          background-color: #03A9F4;
        }
        p {
          margin: 20px;
          padding: 10px 20px;
          border-radius: 20px;
          background-color: #eee;
        }
        core-header-panel {
          background: white;
        }
        tw-menu {
          float: left;
          display: block;
          margin: 12px;
          width: 25%;
        }
        .Negative {
          background-color:rgba(255,0,0,0.3);
        }
       .Positive {
          background-color:rgba(0,255,0,0.3);
        }
  </style>
  <body fullbleed vertical layout unresolved>
  <core-header-panel flex>
    <core-toolbar id="mainheader">
      <span flex>Tweet Words</span>
    </core-toolbar>
    <tw-menu id="menu" selected="0">
      {{range $i := .keywords}}
      <a href="/GetKeywordsServ?keyword={{html $i}}"><core-item  label="{{html $i}}"></core-item></a>
      {{end}}
      <core-item  id='search'>
        <tw-paper-input label="Search"></tw-paper-input>
      </core-item>
    </tw-menu>
    <div id="tweets" style="float: left; width: 60%;">
    <div>
  </core-header-panel>


  <!-- Support for web components technologies if not natively supported -->
  <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>


  <script type="text/javascript">

      function getQueryVariable(variable)
      {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
          var pair = vars[i].split("=");
          if(pair[0] == variable)
            {
              return pair[1];
            }
        }   
        return(false);
      }

      streamUrl = getQueryVariable('keyword');
      if(streamUrl)
      {
          streamUrl= streamUrl.replace('%20','+')

          var source = new EventSource('/' + streamUrl);
          // Create a callback for when a new message is received.
          source.onmessage = function(e) {
            var tweetDiv = document.getElementById('tweets');
            var tweet = document.createElement('p');
            var sse = JSON.parse(e.data);
            tweet.innerText = sse.text
            tweet.classList.add(sse.class)
            tweetDiv.appendChild(tweet)
          };
          source.onerror = function(e) {
            console.log(e)
          };

      }
      
  </script>
</body>
</html>
